import{_ as h,h as _,i as S,r as u,d as q,o as k,e as l,f as o,c as x,l as B,b as f,g as v,t as I,k as T,E as y}from"./index-Dv7cJHYD.js";import{u as C}from"./maintenance-9LlAq3Of.js";const U={key:0},Y={class:"verification-group"},F={__name:"MaintenanceForm",props:{initialData:{type:Object,default:()=>({title:"",content:"",timeRange:[],token:""})}},emits:["submit","cancel"],setup(w,{emit:g}){const b=w,p=g,i=C(),t=_({...b.initialData}),d=_(null),a=_(0),m=S(()=>i.phase2Enabled),R={title:[{required:!0,message:"请输入公告标题",trigger:"blur"},{min:5,max:50,message:"长度在 5 到 50 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],timeRange:[{required:!0,message:"请选择维护时段",trigger:"change",validator:(r,e,n)=>{!e||e.length!==2?n(new Error("请选择维护时段")):n()}}],token:[{required:m.value,message:"请输入验证码",trigger:"blur"},{min:6,max:6,message:"验证码为6位数字",trigger:"blur",validator:(r,e,n)=>{if(!m.value){n();return}/^\d{6}$/.test(e)?n():n(new Error("验证码必须是6位数字"))}}]},E=async()=>{await i.sendVerificationCode(),a.value=60;const r=setInterval(()=>{a.value--,a.value<=0&&clearInterval(r)},1e3)},M=async()=>{try{if(!await d.value.validate())return;const[e,n]=t.value.timeRange;if(new Date(e)>=new Date(n)){ElMessage.error("结束时间必须晚于开始时间");return}p("submit",{title:t.value.title,content:t.value.content,startTime:e,endTime:n,token:t.value.token})}catch(r){console.error("表单验证失败:",r)}},D=()=>{p("cancel")};return(r,e)=>{const n=u("el-input"),c=u("el-form-item"),$=u("el-date-picker"),V=u("el-button"),N=u("el-form");return k(),q(N,{model:t.value,rules:R,ref_key:"formRef",ref:d,"label-width":"120px"},{default:l(()=>[o(c,{label:"公告标题",prop:"title"},{default:l(()=>[o(n,{modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.title=s),placeholder:"请输入公告标题",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(c,{label:"公告内容",prop:"content"},{default:l(()=>[o(n,{modelValue:t.value.content,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.content=s),type:"textarea",rows:5,placeholder:"请输入公告详细内容"},null,8,["modelValue"])]),_:1}),o(c,{label:"维护时段",prop:"timeRange"},{default:l(()=>[o($,{modelValue:t.value.timeRange,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.timeRange=s),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),m.value?(k(),x("div",U,[o(c,{label:"安全验证",prop:"token"},{default:l(()=>[f("div",Y,[o(n,{modelValue:t.value.token,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.token=s),placeholder:"请输入邮件验证码",style:{flex:"1"}},null,8,["modelValue"]),o(V,{disabled:a.value>0,onClick:E},{default:l(()=>[v(I(a.value>0?`${a.value}秒后重发`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})])):B("",!0),o(c,null,{default:l(()=>[o(V,{type:"primary",onClick:M},{default:l(()=>e[4]||(e[4]=[v("提交")])),_:1,__:[4]}),o(V,{onClick:D},{default:l(()=>e[5]||(e[5]=[v("取消")])),_:1,__:[5]})]),_:1})]),_:1},8,["model"])}}},H=h(F,[["__scopeId","data-v-3d2b8fe6"]]),j={class:"app-container"},L={class:"header"},O={class:"main-content form-container"},z={__name:"CreateView",setup(w){const g=T(),b=C(),p=_(null),i=()=>{g.push({name:"list"})},t=async d=>{await b.createMaintenanceNotice(d)?(y.success("公告创建成功"),i()):y.error("公告创建失败")};return(d,a)=>{const m=u("el-button");return k(),x("div",j,[f("div",L,[a[1]||(a[1]=f("h1",null,"新增维护公告",-1)),o(m,{onClick:i},{default:l(()=>a[0]||(a[0]=[v("返回列表")])),_:1,__:[0]})]),f("div",O,[o(H,{ref_key:"formRef",ref:p,onSubmit:t,onCancel:i},null,512)])])}}},J=h(z,[["__scopeId","data-v-53b6462b"]]);export{J as default};
